\section{Introduction}
\label{sec:Introduction}

Facing the explosion of available connected devices, many vendors are jumping into the market, proposing a large spectrum of products ranging from connected devices to associated end-user services~\cite{lee-15}. This results in a wide heterogeneity in software and hardware implementations, as well as an ever growing list of concerns and opportunities in terms of interoperability, data management, privacy and scalability~\cite{chaqfeh-12}.

As the Internet of Things (\IOT) infiltrates many aspects of people's life through their cars, homes or business buildings, phones and so forth, a critical challenge is to provide end-users the possibility to benefit from the plethora of connected devices and configure them for their particular needs. Such configurations should address needs captured by user-defined workflows, or scenarios, that are unlikely to stay unchanged for long; besides, the infinite possibilities offered by even simple combinations of a small number of devices already brings a combinatorial explosion that cannot be captured by configurations that remain static. One possible path towards mastering this complexity is to put the configuration tools directly in the end users' hands, so that they become in charge of managing the workflows they are interested in. This calls for a radical raise in the abstraction level devices are manipulated through, since end users cannot keep up with the ever-evolving \IOT market; however, they usually relate well with basic devices functionalities: a temperature sensor is supposed to capture the temperature; an alarm should buzz in case of emergency; a smart vent or thermostat is supposed to switch on at some predefined conditions, no matter how they communicate with the home, and no matter which vendor manufactured them. Hiding the underlying complexity of protocol communication, data exchange and technical \textsc{Api}s for device manipulation is a key enabler of large adoption of smart devices, especially in the context of smart homes. 

%Moreover, user-defined workflows usually expressed at a high level of abstraction must be somehow translated into runnable entities and the orchestration between many devices usually interconnected into a single workflow is a non-trivial task. In order to hide vendor-specific implementation details, we target a dedicated technology-agnostic environment to adapt and combine \IOT solutions whose external behaviours have been expressed in a specific language.

Model-Driven Engineering (\MDE) has been recognised during the last decade as a software engineering technique dedicated to the design, management and evolution of computer languages enabling automatic generation of production code, diverse types of analysis and early verifications \cite{J:Lucio-Amrani-etAl:2014}. In particular, Domain-Specific (Modelling) Languages (\DSLS) allow the direct manipulation of domain concepts, thus allowing experts to directly manipulate notions they are familiar with. Over the years, the \MDE community put an effort to automate many aspects necessary to facilitate the daily use of such languages, particularly by fading away the distinction between textual and visual language syntaxes, and by bringing appropriate tools to developers to simply and quickly design their own, new \DSLS.

Following this trend, we introduce \IOTDSL, a prototype Domain-Specific Language (\DSL) meant to allow end users drive the \IOT devices installed in their homes. \IOTDSL has two major concepts at its heart. First, it promotes \emph{separation of concerns} by properly distinguishing the phases an \IOT system is composed of, namely capturing the devices capabilities, then deploying them through the house in an interconnected network, and defining scenarios to drive the overall system to achieve end users' goals. Second, it relies on \emph{events} to describe devices capabilities and combine them into rule-based definitions for scenarios \cite{muhl-06,cristea-11}.  Rule-based systems are widely used in a vast range of domains like finance~\cite{schultz-09}, disaster monitoring~\cite{broda-09}, social threats discovery~\cite{baran-13} and so forth. Rules are particularly suitable to express composition of events because of their declarative nature and their high-level of abstraction, thus in \IOTDSL, user scenarios are expressed in a rule-based language that empowers reusability and automatic translation into a runnable Complex Event Processing (\CEP)-based language~\cite{Cugola-Margara:2010}.

%Event-based systems have appeared in many domains and \IOT infrastructures are well known examples of such systems~\cite{muhl-06,cristea-11}. Rule-based systems are widely used in a vast range of domains like finance~\cite{schultz-09}, disaster monitoring~\cite{broda-09}, social threats discovery~\cite{baran-13} and so forth. Rules are particularly suitable to express composition of events because of their declarative nature and their high-level of abstraction, thus in \IOTDSL, user scenarios are expressed in a rule-based language that empowers reusability and automatic translation into a runnable Complex Event Processing (\CEP)-based language~\cite{cugola-12}.

\noindent
\textbf{Outline.} Compared to \cite{Amrani-Gilson-Debieche-Englebert:2017}, we present in this paper a full compilation scheme for \IOTDSL: any instance of the language could then be translated into an executable framework, namely TRex \cite{cugola-12}, that can be embedded in a middleware that orchestrate devices intercommunication by centralising information delivered by sensors and taking the appropriate decisions to activate reactions according to end users scenarios. 
We start in Section \ref{sec:Motivation} by presenting an archetypal scenario of a smart house to highlight the usefulness to bring end-users back in control of their own domestic \IOT environment. We also extract the crucial \IOT challenges specific to the use of \DSLS and \MDE techniques to realise this vision. In Section \ref{sec:IoTDSL}, we introduce \IOTDSL, our prototype \DSL to specify and interconnect devices in an intuitive and general way and illustrate its benefits through use cases extracted from our smart house example. Then, in Section~\ref{sec:CG}, we detail how we translate \IOTDSL rules into a concrete \CEP engine and how we generate simulation facilities meant to test and validate the \IOT deployment. We discuss our approach and the remaining challenges to tackle in Section~\ref{sec:Discussion}. We overview in Section~\ref{sec:RW} the use of \DSLS for \IOT, comparing existing approaches with ours and assessing them against the challenges we identified. Finally, we conclude in Section \ref{sec:Conclusion} and present the main lines of work ahead to transform our prototype in a fully functional \DSL framework.
